/**
 * @Author Angus <angusyoung@mrxcool.com>
 * @Description this is the file's description. you can write anything in here.
 * @Since 2018/8/17
 */

const express = require('express');
const multer = require('multer');
const MAO = require('./index');

const upload = multer({
	storage: MAO({
		config  : {
			region         : 'oss-cn-shenzhen',
			accessKeyId    : 'LTAItX5GTrs1m6Mf',
			accessKeySecret: '6h8JsKwqXOl6a4QWHZAiGK7Tp1FCSa',
			bucket         : 'ic-res'
		},
		filename: function (req, file, cb) {
			cb(null, 'test/' + Date.now() + '_' + file.originalname);
		}
	})
});

const app = express();

app.get('/', function (req, res, next) {
	res.send('hello world');
});
app.post('/upload', upload.single('file'), function (req, res, next) {
	res.json(req.file);
});

app.listen(6100, function () {
	console.log('run app on port 6100');
});